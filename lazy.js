(function(){document.documentElement.style.visibility="hidden";const e=new Map;let t=0,n=new WeakSet;const o=function(e){return n.has(e)||e.closest(".slick_carousel")||e.closest("#st-visual-editor")||e.closest(".send")||e.closest(".st-emoji-container")||e.closest(".ve-dropdown-list")||e.closest(".emoji_content")||e.closest("#emoticon-popup1")||e.hasAttribute("data-src")||e.classList.contains("lazyload")||e.classList.contains("lazyloaded")||e.getAttribute("decoding")==="async"||e.src.indexOf("data:")===0||e.complete},i="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxIiBoZWlnaHQ9IjEiPjwvc3ZnPg==",s=function(e,t){return 1===e&&1===t||!e&&!t?i:(t='<svg xmlns=\'http://www.w3.org/2000/svg\' width=\''+(e||1)+'\' height=\''+(t||1)+'\' viewBox=\'0 0 '+(e||1)+' '+(t||1)+'\'></svg>',"data:image/svg+xml;base64,"+btoa(t))},r=function(e){return new Promise((t,n)=>{const o=new Image,i=setTimeout(()=>{o.onload=o.onerror=null,n(new Error("Image load timeout"))},3e3);o.onload=function(){clearTimeout(i),t({width:o.naturalWidth,height:o.naturalHeight})},o.onerror=function(){clearTimeout(i),n(new Error("Image failed to load"))},o.src=e})},a=async function(o){if(n.has(o))return;const i=o.src;if(!i||i.indexOf("data:")===0)return;n.add(o),t++;try{let n;e.has(i)?n=e.get(i):(n=await r(i),e.set(i,n)),o.src=s(n&&n.width,n&&n.height),o.setAttribute("data-src",i),o.classList.add("lazyload"),o.setAttribute("decoding","async"),n&&n.width&&n.height&&(o.setAttribute("width",n.width),o.setAttribute("height",n.height))}catch{o.src=i,o.setAttribute("data-src",i),o.classList.add("lazyload")}finally{t--,0===t&&(document.documentElement.style.visibility="visible")}},c=async function(){try{const e=Array.from(document.querySelectorAll("img:not([data-src]):not(.lazyload):not(.lazyloaded)"));if(0===e.length)return void(document.documentElement.style.visibility="visible");await Promise.allSettled(e.map(e=>a(e))),0===t&&(document.documentElement.style.visibility="visible")}catch{document.documentElement.style.visibility="visible"}};let d;const lazim=new MutationObserver(e=>{clearTimeout(d),d=setTimeout(()=>{const t=[];e.forEach(e=>{e.addedNodes.forEach(e=>{1===e.nodeType&&("IMG"===e.tagName?t.push(e):e.querySelectorAll&&t.push(...e.querySelectorAll("img:not([data-src]):not(.lazyload):not(.lazyloaded)")))})}),Promise.allSettled(t.map(e=>a(e)))},100)});"loading"===document.readyState?document.addEventListener("DOMContentLoaded",c):c(),lazim.observe(document.documentElement,{childList:!0,subtree:!0});const l=["ajaxComplete","ajaxSuccess","load","pageshow"];l.forEach(e=>{window.addEventListener(e,c,{passive:!0})})})();
